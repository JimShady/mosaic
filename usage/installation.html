<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation guide &mdash; Mosaic</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/fonts.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GDAL Installation guide" href="install-gdal.html" />
    <link rel="prev" title="Usage" href="usage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Mosaic
              <img src="../_static/mosaic_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="usage.html">Usage</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="install-gdal.html">GDAL Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid-indexes.html">Using grid index systems in Mosaic</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid-indexes-bng.html">BNG - British National Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quickstart notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="kepler.html">Kepler visualizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="automatic-sql-registration.html">Automatic SQL registration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../literature/videos.html">Mosaic Videos and Talks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Mosaic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="usage.html">Usage</a></li>
      <li class="breadcrumb-item active">Installation guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/usage/installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation-guide">
<h1>Installation guide<a class="headerlink" href="#installation-guide" title="Permalink to this heading"></a></h1>
<section id="supported-platforms">
<h2>Supported platforms<a class="headerlink" href="#supported-platforms" title="Permalink to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For Mosaic 0.4 series, we recommend DBR 13.3 LTS on Photon or ML Runtime clusters.</p>
</div>
<p>Mosaic 0.4.x series only supports DBR 13.x DBRs. If running on a different DBR it will throw an exception:</p>
<p><strong>DEPRECATION ERROR: Mosaic v0.4.x series only supports Databricks Runtime 13. You can specify
`%pip install ‘databricks-mosaic&lt;0.4,&gt;=0.3’` for DBR &lt; 13.</strong></p>
<p>Mosaic 0.4.x series issues an ERROR on standard, non-Photon clusters <a class="reference external" href="https://learn.microsoft.com/en-us/azure/databricks/runtime/">ADB</a> |
<a class="reference external" href="https://docs.databricks.com/runtime/index.html/">AWS</a> |
<a class="reference external" href="https://docs.gcp.databricks.com/runtime/index.html/">GCP</a> :</p>
<p><strong>DEPRECATION ERROR: Please use a Databricks Photon-enabled Runtime for performance benefits or Runtime ML for spatial
AI benefits; Mosaic 0.4.x series restricts executing this cluster.</strong></p>
<p>As of Mosaic 0.4.0 (subject to change in follow-on releases)</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://docs.databricks.com/en/compute/configure.html#access-modes">Assigned Clusters</a> : Mosaic Python, SQL, R, and Scala APIs.</p></li>
<li><p><a class="reference external" href="https://docs.databricks.com/en/compute/configure.html#access-modes">Shared Access Clusters</a> : Mosaic Scala API (JVM) with
Admin <a class="reference external" href="https://docs.databricks.com/en/data-governance/unity-catalog/manage-privileges/allowlist.html">allowlisting</a> ;
Python bindings to Mosaic Scala APIs are blocked by Py4J Security on Shared Access Clusters.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of Mosaic 0.4.0 (subject to change in follow-on releases)</p>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://www.databricks.com/product/unity-catalog">Unity Catalog</a><span class="classifier">Enforces process isolation which is difficult to</span></dt><dd><p>accomplish with custom JVM libraries; as such only built-in (aka platform provided) JVM APIs can be invoked from other
supported languages in Shared Access Clusters.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://docs.databricks.com/en/connect/unity-catalog/volumes.html">Volumes</a><span class="classifier">Along the same principle of isolation,</span></dt><dd><p>clusters (both assigned and shared access) can read Volumes via relevant built-in readers and writers or via custom
python calls which do not involve any custom JVM code.</p>
</dd>
</dl>
</li>
</ul>
</div>
<p>If you have cluster creation permissions in your Databricks
workspace, you can create a cluster using the instructions
<a class="reference external" href="https://docs.databricks.com/clusters/create.html#use-the-cluster-ui">here</a>.</p>
<p>You will also need “Can Manage” permissions on this cluster in order to attach the
Mosaic library to your cluster. A workspace administrator will be able to grant
these permissions and more information about cluster permissions can be found
in our documentation
<a class="reference external" href="https://docs.databricks.com/security/access-control/cluster-acl.html#cluster-level-permissions">here</a>.</p>
</section>
<section id="package-installation">
<h2>Package installation<a class="headerlink" href="#package-installation" title="Permalink to this heading"></a></h2>
<section id="installation-from-pypi">
<h3>Installation from PyPI<a class="headerlink" href="#installation-from-pypi" title="Permalink to this heading"></a></h3>
<p>Python users can install the library directly from <a class="reference external" href="https://pypi.org/project/databricks-mosaic/">PyPI</a>
using the instructions <a class="reference external" href="https://docs.databricks.com/libraries/cluster-libraries.html">here</a>
or from within a Databricks notebook using the <code class="code docutils literal notranslate"><span class="pre">%pip</span></code> magic command, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%pip<span class="w"> </span>install<span class="w"> </span>databricks-mosaic
</pre></div>
</div>
<p>When you install with <code class="code docutils literal notranslate"><span class="pre">%pip</span></code>, the JAR is availalbe from the Python WHL (see the “Enabling” section for more); also,
if you need to install Mosaic 0.3 series for DBR 12.2 LTS, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;databricks-mosaic&lt;0.4,&gt;=0.3&quot;</span>
</pre></div>
</div>
<p>For Mosaic versions &lt; 0.4 please use the <a class="reference external" href="https://databrickslabs.github.io/mosaic/v0.3.x/index.html">0.3 docs</a>.</p>
</section>
<section id="installation-from-release-artifacts">
<h3>Installation from release artifacts<a class="headerlink" href="#installation-from-release-artifacts" title="Permalink to this heading"></a></h3>
<p>Alternatively, you can access the latest release artifacts <a class="reference external" href="https://github.com/databrickslabs/mosaic/releases">here</a>
and manually attach the appropriate library to your cluster.</p>
<p>Which artifact you choose to attach will depend on the language API you intend to use.</p>
<ul class="simple">
<li><p>For Python API users, choose the Python .whl file (includes the JAR)</p></li>
<li><p>For Scala users, take the Scala JAR (packaged with all necessary dependencies).</p></li>
<li><p>For R users, download the Scala JAR and the R bindings library [see the sparkR readme](R/sparkR-mosaic/README.md).</p></li>
</ul>
<p>Instructions for how to attach libraries to a Databricks cluster can be found <a class="reference external" href="https://docs.databricks.com/libraries/cluster-libraries.html">here</a>.</p>
</section>
<section id="automated-sql-registration">
<h3>Automated SQL registration<a class="headerlink" href="#automated-sql-registration" title="Permalink to this heading"></a></h3>
<p>If you would like to use Mosaic’s functions in pure SQL (in a SQL notebook, from a business intelligence tool,
or via a middleware layer such as Geoserver, perhaps) then you can configure
“Automatic SQL Registration” using the instructions <a class="reference external" href="https://databrickslabs.github.io/mosaic/usage/automatic-sql-registration.html">here</a>.</p>
</section>
</section>
<section id="enabling-the-mosaic-functions">
<h2>Enabling the Mosaic functions<a class="headerlink" href="#enabling-the-mosaic-functions" title="Permalink to this heading"></a></h2>
<p>The mechanism for enabling the Mosaic functions varies by language:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-0-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-0-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button><button aria-controls="panel-0-Ug==" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-Ug==" name="Ug==" role="tab" tabindex="-1">R</button></div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mosaic</span> <span class="k">as</span> <span class="nn">mos</span>
<span class="n">mos</span><span class="o">.</span><span class="n">enable_mosaic</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">dbutils</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">databricks</span><span class="p">.</span><span class="nn">labs</span><span class="p">.</span><span class="nn">mosaic</span><span class="p">.</span><span class="nn">functions</span><span class="p">.</span><span class="nc">MosaicContext</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">databricks</span><span class="p">.</span><span class="nn">labs</span><span class="p">.</span><span class="nn">mosaic</span><span class="p">.</span><span class="nc">H3</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">databricks</span><span class="p">.</span><span class="nn">labs</span><span class="p">.</span><span class="nn">mosaic</span><span class="p">.</span><span class="nc">JTS</span>

<span class="kd">val</span><span class="w"> </span><span class="n">mosaicContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MosaicContext</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="nc">H3</span><span class="p">,</span><span class="w"> </span><span class="nc">JTS</span><span class="p">)</span>
<span class="k">import</span><span class="w"> </span><span class="nn">mosaicContext</span><span class="p">.</span><span class="nn">functions</span><span class="p">.</span><span class="n">_</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-Ug==" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-Ug==" name="Ug==" role="tabpanel" tabindex="0"><div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">sparkrMosaic</span><span class="p">)</span>
<span class="nf">enableMosaic</span><span class="p">()</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We recommend use of <cite>import mosaic as mos</cite> to namespace the python api and avoid any conflicts with other similar
functions. By default, the python import will handle installing the JAR and registering Hive UDFs which is suitable
for Assigned (vs Shared Access) clusters.</p>
</div>
<p>Unless you are specially adding the JAR to your cluster (outside <code class="code docutils literal notranslate"><span class="pre">%pip</span></code> or the WHL file), please always initialize
with Python first, then you can initialize Scala (after the JAR has been auto-attached by python); otherwise, you don’t
need to initialize Scala unless you are using that language binding. You can further configure Mosaic enable with spark
confs as well as through extra params in Mosaic 0.4.x series <code class="code docutils literal notranslate"><span class="pre">enable_mosaic</span></code> function.</p>
<dl class="py function">
<dt class="sig sig-object py" id="enable_mosaic">
<span class="sig-name descname"><span class="pre">enable_mosaic</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#enable_mosaic" title="Permalink to this definition"></a></dt>
<dd><p>Use this function at the start of your workflow to ensure all the required dependencies are installed and
Mosaic is configured according to your needs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spark</strong> (<em>pyspark.sql.SparkSession</em>) – The active spark session.</p></li>
<li><p><strong>dbutils</strong> (<em>dbruntime.dbutils.DBUtils</em>) – Specify dbutils object used for <code class="code docutils literal notranslate"><span class="pre">display</span></code> and <code class="code docutils literal notranslate"><span class="pre">displayHTML</span></code> functions, needed for Kepler integration (Optional, default is None).</p></li>
<li><p><strong>log_info</strong> (<em>bool</em>) – True will try to setLogLevel to “info”, False will not (Optional, default is False).</p></li>
<li><p><strong>jar_path</strong> (<em>str</em>) – If provided, sets <code class="code docutils literal notranslate"><span class="pre">&quot;spark.databricks.labs.mosaic.jar.path&quot;</span></code> (Optional, default is None).</p></li>
<li><p><strong>jar_autoattach</strong> (<em>bool</em>) – False will not registers the JAR; sets <code class="code docutils literal notranslate"><span class="pre">&quot;spark.databricks.labs.mosaic.jar.autoattach&quot;</span></code> to False, True will register the JAR (Optional, default is True).</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<p>Users can control various aspects of Mosaic’s operation with the following Spark confs:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">&quot;spark.databricks.labs.mosaic.jar.autoattach&quot;</span></code> - Automatically attach the Mosaic JAR to the Databricks cluster (Optional, default is “true”).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&quot;spark.databricks.labs.mosaic.jar.path&quot;</span></code> - Explicitly specify the path to the Mosaic JAR (Optional and not required at all in a standard Databricks environment).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&quot;spark.databricks.labs.mosaic.geometry.api&quot;</span></code> - Explicitly specify the underlying geometry library to use for spatial operations (Optional, default is “JTS”).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&quot;spark.databricks.labs.mosaic.index.system&quot;</span></code> - Explicitly specify the index system to use for optimized spatial joins (Optional, default is “H3”).</p></li>
</ul>
</div></blockquote>
<section id="sql-usage">
<h3>SQL usage<a class="headerlink" href="#sql-usage" title="Permalink to this heading"></a></h3>
<p>If you have not employed <a class="reference internal" href="automatic-sql-registration.html#automatic-sql-registration"><span class="std std-ref">Automatic SQL registration</span></a> (on by default and handled by Python enable in notebook), you will need to
register the Mosaic SQL functions in your SparkSession from a Scala notebook cell:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">databricks</span><span class="p">.</span><span class="nn">labs</span><span class="p">.</span><span class="nn">mosaic</span><span class="p">.</span><span class="nn">functions</span><span class="p">.</span><span class="nc">MosaicContext</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">databricks</span><span class="p">.</span><span class="nn">labs</span><span class="p">.</span><span class="nn">mosaic</span><span class="p">.</span><span class="nc">H3</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com</span><span class="p">.</span><span class="nn">databricks</span><span class="p">.</span><span class="nn">labs</span><span class="p">.</span><span class="nn">mosaic</span><span class="p">.</span><span class="nc">JTS</span>

<span class="kd">val</span><span class="w"> </span><span class="n">mosaicContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MosaicContext</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="nc">H3</span><span class="p">,</span><span class="w"> </span><span class="nc">JTS</span><span class="p">)</span>
<span class="n">mosaicContext</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Mosaic 0.4.x SQL bindings for DBR 13 can register with Assigned clusters (as Hive UDFs), but not Shared Access due
to <a class="reference external" href="https://www.databricks.com/product/unity-catalog">Unity Catalog</a> API changes, more <a class="reference external" href="https://docs.databricks.com/en/udf/index.html">here</a>.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="usage.html" class="btn btn-neutral float-left" title="Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="install-gdal.html" class="btn btn-neutral float-right" title="GDAL Installation guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Databricks Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>